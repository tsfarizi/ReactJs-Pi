import n from"lodash/uniq.js";import t from"lodash/uniqBy.js";import e from"lodash/sortBy.js";import r from"lodash/last.js";import i from"lodash/isDate.js";import{utcParse as a,timeParse as o}from"d3-time-format";import{scaleLinear as u,scalePoint as c,scaleBand as s,scaleUtc as d,scaleTime as m,scaleLog as f,scaleSymlog as l}from"d3-scale";import{interpolateRound as v,interpolateNumber as p}from"d3-interpolate";import{timeInterval as y,timeMillisecond as h,utcMillisecond as g,timeSecond as x,utcSecond as k,timeMinute as T,utcMinute as b,timeHour as M,utcHour as w,timeWeek as E,utcWeek as S,timeSunday as C,utcSunday as U,timeMonday as j,utcMonday as D,timeTuesday as O,utcTuesday as H,timeWednesday as R,utcWednesday as V,timeThursday as q,utcThursday as A,timeFriday as B,utcFriday as F,timeSaturday as N,utcSaturday as z,timeMonth as I,utcMonth as P,timeYear as $,utcYear as G}from"d3-time";function J(){return J=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)({}).hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},J.apply(null,arguments)}var K=["millisecond","second","minute","hour","day","month","year"],L=[function(n){return n.setMilliseconds(0)},function(n){return n.setSeconds(0)},function(n){return n.setMinutes(0)},function(n){return n.setHours(0)},function(n){return n.setDate(1)},function(n){return n.setMonth(0)}],Q={millisecond:[],second:L.slice(0,1),minute:L.slice(0,2),hour:L.slice(0,3),day:L.slice(0,4),month:L.slice(0,5),year:L.slice(0,6)},W=function(n){return function(t){return Q[n].forEach((function(n){n(t)})),t}},X=function(n){var t=n.format,e=void 0===t?"native":t,r=n.precision,i=void 0===r?"millisecond":r,u=n.useUTC,c=void 0===u||u,s=W(i);return function(n){if(void 0===n)return n;if("native"===e||n instanceof Date)return s(n);var t=c?a(e):o(e);return s(t(n))}},Y={type:"linear",min:0,max:"auto",stacked:!1,reverse:!1,clamp:!1,nice:!0,round:!1},Z=function(n,t,e,r){var i,a,o,c,s=n.min,d=void 0===s?Y.min:s,m=n.max,f=void 0===m?Y.max:m,l=n.stacked,y=void 0===l?Y.stacked:l,h=n.reverse,g=void 0===h?Y.reverse:h,x=n.clamp,k=void 0===x?Y.clamp:x,T=n.nice,b=void 0===T?Y.nice:T,M=n.round,w=void 0===M?Y.round:M;"auto"===d?i=!0===y?null!=(a=t.minStacked)?a:0:t.min:i=d;"auto"===f?o=!0===y?null!=(c=t.maxStacked)?c:0:t.max:o=f;var E=u().range("x"===r?[0,e]:[e,0]).interpolate(w?v:p).domain(g?[o,i]:[i,o]).clamp(k);return!0===b?E.nice():"number"==typeof b&&E.nice(b),_(E,y)},_=function(n,t){void 0===t&&(t=!1);var e=n;return e.type="linear",e.stacked=t,e},nn=function(n,t,e){var r=c().range([0,e]).domain(t.all);return r.type="point",r},tn=function(n){var t=n;return t.type="point",t},en={type:"band",round:!1},rn=function(n,t,e,r){var i=n.round,a=void 0===i?en.round:i,o=s().range("x"===r?[0,e]:[e,0]).domain(t.all).round(a);return an(o)},an=function(n){var t=n;return t.type="band",t},on={type:"time",format:"native",precision:"millisecond",min:"auto",max:"auto",useUTC:!0,nice:!1},un=function(n,t,e){var r,i,a=n.format,o=void 0===a?on.format:a,u=n.precision,c=void 0===u?on.precision:u,s=n.min,f=void 0===s?on.min:s,l=n.max,v=void 0===l?on.max:l,p=n.useUTC,y=void 0===p?on.useUTC:p,h=n.nice,g=void 0===h?on.nice:h,x=X({format:o,precision:c,useUTC:y});r="auto"===f?x(t.min):"native"!==o?x(f):f,i="auto"===v?x(t.max):"native"!==o?x(v):v;var k=y?d():m();k.range([0,e]),r&&i&&k.domain([r,i]),!0===g?k.nice():"object"!=typeof g&&"number"!=typeof g||k.nice(g);var T=k;return T.type="time",T.useUTC=y,T},cn={type:"log",base:10,min:"auto",max:"auto",round:!1,reverse:!1,nice:!0},sn=function(n,t,e,r){var i,a=n.base,o=void 0===a?cn.base:a,u=n.min,c=void 0===u?cn.min:u,s=n.max,d=void 0===s?cn.max:s,m=n.round,l=void 0===m?cn.round:m,v=n.reverse,p=void 0===v?cn.reverse:v,y=n.nice,h=void 0===y?cn.nice:y;if(t.all.some((function(n){return 0===n})))throw new Error("a log scale domain must not include or cross zero");var g,x,k=!1;if(t.all.filter((function(n){return null!=n})).forEach((function(n){k||(void 0===i?i=Math.sign(n):Math.sign(n)!==i&&(k=!0))})),k)throw new Error("a log scale domain must be strictly-positive or strictly-negative");g="auto"===c?t.min:c,x="auto"===d?t.max:d;var T=f().base(o),b="x"===r?[0,e]:[e,0];!0===l?T.rangeRound(b):T.range(b),!0===p?T.domain([x,g]):T.domain([g,x]),!0===h?T.nice():"number"==typeof h&&T.nice(h);var M=T;return M.type="log",M},dn={type:"symlog",constant:1,min:"auto",max:"auto",round:!1,reverse:!1,nice:!0},mn=function(n,t,e,r){var i,a,o=n.constant,u=void 0===o?dn.constant:o,c=n.min,s=void 0===c?dn.min:c,d=n.max,m=void 0===d?dn.max:d,f=n.round,v=void 0===f?dn.round:f,p=n.reverse,y=void 0===p?dn.reverse:p,h=n.nice,g=void 0===h?dn.nice:h;i="auto"===s?t.min:s,a="auto"===m?t.max:m;var x=l().constant(u),k="x"===r?[0,e]:[e,0];!0===v?x.rangeRound(k):x.range(k),!0===y?x.domain([a,i]):x.domain([i,a]),!0===g?x.nice():"number"==typeof g&&x.nice(g);var T=x;return T.type="symlog",T},fn=function(n){return"x"===n?"y":"x"},ln=function(n,t){return n===t},vn=function(n,t){return n.getTime()===t.getTime()};function pn(n,t,e,r){switch(n.type){case"linear":return Z(n,t,e,r);case"point":return nn(0,t,e);case"band":return rn(n,t,e,r);case"time":return un(n,t,e);case"log":return sn(n,t,e,r);case"symlog":return mn(n,t,e,r);default:throw new Error("invalid scale spec")}}var yn=function(n,t,e){var r;if("stacked"in e&&e.stacked){var i=n.data["x"===t?"xStacked":"yStacked"];return null==i?null:e(i)}return null!=(r=e(n.data[t]))?r:null},hn=function(n,t,e,r,i){var a=n.map((function(n){return function(n){return J({},n,{data:n.data.map((function(n){return{data:J({},n)}}))})}(n)})),o=gn(a,t,e);"stacked"in t&&!0===t.stacked&&Tn(o,a),"stacked"in e&&!0===e.stacked&&bn(o,a);var u=pn(t,o.x,r,"x"),c=pn(e,o.y,i,"y"),s=a.map((function(n){return J({},n,{data:n.data.map((function(n){return J({},n,{position:{x:yn(n,"x",u),y:yn(n,"y",c)}})}))})}));return J({},o,{series:s,xScale:u,yScale:c})},gn=function(n,t,e){return{x:xn(n,"x",t),y:xn(n,"y",e)}},xn=function(i,a,o,u){var c=void 0===u?{}:u,s=c.getValue,d=void 0===s?function(n){return n.data[a]}:s,m=c.setValue,f=void 0===m?function(n,t){n.data[a]=t}:m;if("linear"===o.type)i.forEach((function(n){n.data.forEach((function(n){var t=d(n);t&&f(n,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var l=X(o);i.forEach((function(n){n.data.forEach((function(n){var t=d(n);t&&f(n,l(t))}))}))}var v=[];switch(i.forEach((function(n){n.data.forEach((function(n){v.push(d(n))}))})),o.type){case"linear":var p=e(n(v).filter((function(n){return null!==n})),(function(n){return n}));return{all:p,min:Math.min.apply(Math,p),max:Math.max.apply(Math,p)};case"time":var y=t(v,(function(n){return n.getTime()})).slice(0).sort((function(n,t){return t.getTime()-n.getTime()})).reverse();return{all:y,min:y[0],max:r(y)};default:var h=n(v);return{all:h,min:h[0],max:r(h)}}},kn=function(n,t,e){var a=fn(n),o=[];t[a].all.forEach((function(t){var u=i(t)?vn:ln,c=[];e.forEach((function(e){var i=e.data.find((function(n){return u(n.data[a],t)})),s=null,d=null;if(void 0!==i){if(null!==(s=i.data[n])){var m=r(c);void 0===m?d=s:null!==m&&(d=m+s)}i.data["x"===n?"xStacked":"yStacked"]=d}c.push(d),null!==d&&o.push(d)}))})),t[n].minStacked=Math.min.apply(Math,o),t[n].maxStacked=Math.max.apply(Math,o)},Tn=function(n,t){return kn("x",n,t)},bn=function(n,t){return kn("y",n,t)},Mn=function(n){var t=n.bandwidth();if(0===t)return n;var e=t/2;return n.round()&&(e=Math.round(e)),function(t){var r;return(null!=(r=n(t))?r:0)+e}},wn={millisecond:[h,g],second:[x,k],minute:[T,b],hour:[M,w],day:[y((function(n){return n.setHours(0,0,0,0)}),(function(n,t){return n.setDate(n.getDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)})),y((function(n){return n.setUTCHours(0,0,0,0)}),(function(n,t){return n.setUTCDate(n.getUTCDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)}))],week:[E,S],sunday:[C,U],monday:[j,D],tuesday:[O,H],wednesday:[R,V],thursday:[q,A],friday:[B,F],saturday:[N,z],month:[I,P],year:[$,G]},En=Object.keys(wn),Sn=new RegExp("^every\\s*(\\d+)?\\s*("+En.join("|")+")s?$","i"),Cn=function(n,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in n){var e=t.match(Sn);if(e){var r=e[1],i=e[2],a=wn[i][n.useUTC?1:0];if("day"===i){var o,u,c=n.domain(),s=c[0],d=c[1],m=new Date(d);return m.setDate(m.getDate()+1),null!=(o=null==(u=a.every(Number(null!=r?r:1)))?void 0:u.range(s,m))?o:[]}if(void 0===r)return n.ticks(a);var f=a.every(Number(r));if(f)return n.ticks(f)}throw new Error("Invalid tickValues: "+t)}if("ticks"in n){if(void 0===t)return n.ticks();if("number"==typeof(l=t)&&isFinite(l)&&Math.floor(l)===l)return n.ticks(t)}var l;return n.domain()},Un=function(n){return"linear"===n.type||"log"===n.type||"symlog"===n.type};export{en as bandScaleDefaults,an as castBandScale,_ as castLinearScale,tn as castPointScale,Mn as centerScale,vn as compareDateValues,ln as compareValues,pn as computeScale,hn as computeXYScalesForSeries,rn as createBandScale,X as createDateNormalizer,Z as createLinearScale,sn as createLogScale,nn as createPointScale,W as createPrecisionMethod,mn as createSymlogScale,un as createTimeScale,xn as generateSeriesAxis,gn as generateSeriesXY,fn as getOtherAxis,Cn as getScaleTicks,Un as isReversibleScaleSpec,Y as linearScaleDefaults,cn as logScaleDefaults,L as precisionCutOffs,Q as precisionCutOffsByType,kn as stackAxis,dn as symlogScaleDefaults,K as timePrecisions,on as timeScaleDefaults};
//# sourceMappingURL=nivo-scales.mjs.map
