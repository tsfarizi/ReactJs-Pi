"use strict";var e=require("lodash/uniq.js"),t=require("lodash/uniqBy.js"),n=require("lodash/sortBy.js"),r=require("lodash/last.js"),a=require("lodash/isDate.js"),i=require("d3-time-format"),o=require("d3-scale"),u=require("d3-interpolate"),c=require("d3-time");function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(null,arguments)}var l=[function(e){return e.setMilliseconds(0)},function(e){return e.setSeconds(0)},function(e){return e.setMinutes(0)},function(e){return e.setHours(0)},function(e){return e.setDate(1)},function(e){return e.setMonth(0)}],d={millisecond:[],second:l.slice(0,1),minute:l.slice(0,2),hour:l.slice(0,3),day:l.slice(0,4),month:l.slice(0,5),year:l.slice(0,6)},m=function(e){return function(t){return d[e].forEach((function(e){e(t)})),t}},f=function(e){var t=e.format,n=void 0===t?"native":t,r=e.precision,a=void 0===r?"millisecond":r,o=e.useUTC,u=void 0===o||o,c=m(a);return function(e){if(void 0===e)return e;if("native"===n||e instanceof Date)return c(e);var t=u?i.utcParse(n):i.timeParse(n);return c(t(e))}},v={type:"linear",min:0,max:"auto",stacked:!1,reverse:!1,clamp:!1,nice:!0,round:!1},p=function(e,t,n,r){var a,i,c,s,l=e.min,d=void 0===l?v.min:l,m=e.max,f=void 0===m?v.max:m,p=e.stacked,x=void 0===p?v.stacked:p,h=e.reverse,g=void 0===h?v.reverse:h,S=e.clamp,k=void 0===S?v.clamp:S,T=e.nice,M=void 0===T?v.nice:T,b=e.round,D=void 0===b?v.round:b;"auto"===d?a=!0===x?null!=(i=t.minStacked)?i:0:t.min:a=d;"auto"===f?c=!0===x?null!=(s=t.maxStacked)?s:0:t.max:c=f;var w=o.scaleLinear().range("x"===r?[0,n]:[n,0]).interpolate(D?u.interpolateRound:u.interpolateNumber).domain(g?[c,a]:[a,c]).clamp(k);return!0===M?w.nice():"number"==typeof M&&w.nice(M),y(w,x)},y=function(e,t){void 0===t&&(t=!1);var n=e;return n.type="linear",n.stacked=t,n},x=function(e,t,n){var r=o.scalePoint().range([0,n]).domain(t.all);return r.type="point",r},h={type:"band",round:!1},g=function(e,t,n,r){var a=e.round,i=void 0===a?h.round:a,u=o.scaleBand().range("x"===r?[0,n]:[n,0]).domain(t.all).round(i);return S(u)},S=function(e){var t=e;return t.type="band",t},k={type:"time",format:"native",precision:"millisecond",min:"auto",max:"auto",useUTC:!0,nice:!1},T=function(e,t,n){var r,a,i=e.format,u=void 0===i?k.format:i,c=e.precision,s=void 0===c?k.precision:c,l=e.min,d=void 0===l?k.min:l,m=e.max,v=void 0===m?k.max:m,p=e.useUTC,y=void 0===p?k.useUTC:p,x=e.nice,h=void 0===x?k.nice:x,g=f({format:u,precision:s,useUTC:y});r="auto"===d?g(t.min):"native"!==u?g(d):d,a="auto"===v?g(t.max):"native"!==u?g(v):v;var S=y?o.scaleUtc():o.scaleTime();S.range([0,n]),r&&a&&S.domain([r,a]),!0===h?S.nice():"object"!=typeof h&&"number"!=typeof h||S.nice(h);var T=S;return T.type="time",T.useUTC=y,T},M={type:"log",base:10,min:"auto",max:"auto",round:!1,reverse:!1,nice:!0},b=function(e,t,n,r){var a,i=e.base,u=void 0===i?M.base:i,c=e.min,s=void 0===c?M.min:c,l=e.max,d=void 0===l?M.max:l,m=e.round,f=void 0===m?M.round:m,v=e.reverse,p=void 0===v?M.reverse:v,y=e.nice,x=void 0===y?M.nice:y;if(t.all.some((function(e){return 0===e})))throw new Error("a log scale domain must not include or cross zero");var h,g,S=!1;if(t.all.filter((function(e){return null!=e})).forEach((function(e){S||(void 0===a?a=Math.sign(e):Math.sign(e)!==a&&(S=!0))})),S)throw new Error("a log scale domain must be strictly-positive or strictly-negative");h="auto"===s?t.min:s,g="auto"===d?t.max:d;var k=o.scaleLog().base(u),T="x"===r?[0,n]:[n,0];!0===f?k.rangeRound(T):k.range(T),!0===p?k.domain([g,h]):k.domain([h,g]),!0===x?k.nice():"number"==typeof x&&k.nice(x);var b=k;return b.type="log",b},D={type:"symlog",constant:1,min:"auto",max:"auto",round:!1,reverse:!1,nice:!0},w=function(e,t,n,r){var a,i,u=e.constant,c=void 0===u?D.constant:u,s=e.min,l=void 0===s?D.min:s,d=e.max,m=void 0===d?D.max:d,f=e.round,v=void 0===f?D.round:f,p=e.reverse,y=void 0===p?D.reverse:p,x=e.nice,h=void 0===x?D.nice:x;a="auto"===l?t.min:l,i="auto"===m?t.max:m;var g=o.scaleSymlog().constant(c),S="x"===r?[0,n]:[n,0];!0===v?g.rangeRound(S):g.range(S),!0===y?g.domain([i,a]):g.domain([a,i]),!0===h?g.nice():"number"==typeof h&&g.nice(h);var k=g;return k.type="symlog",k},E=function(e){return"x"===e?"y":"x"},C=function(e,t){return e===t},U=function(e,t){return e.getTime()===t.getTime()};function q(e,t,n,r){switch(e.type){case"linear":return p(e,t,n,r);case"point":return x(0,t,n);case"band":return g(e,t,n,r);case"time":return T(e,t,n);case"log":return b(e,t,n,r);case"symlog":return w(e,t,n,r);default:throw new Error("invalid scale spec")}}var j=function(e,t,n){var r;if("stacked"in n&&n.stacked){var a=e.data["x"===t?"xStacked":"yStacked"];return null==a?null:n(a)}return null!=(r=n(e.data[t]))?r:null},P=function(e,t,n){return{x:O(e,"x",t),y:O(e,"y",n)}},O=function(a,i,o,u){var c=void 0===u?{}:u,s=c.getValue,l=void 0===s?function(e){return e.data[i]}:s,d=c.setValue,m=void 0===d?function(e,t){e.data[i]=t}:d;if("linear"===o.type)a.forEach((function(e){e.data.forEach((function(e){var t=l(e);t&&m(e,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var v=f(o);a.forEach((function(e){e.data.forEach((function(e){var t=l(e);t&&m(e,v(t))}))}))}var p=[];switch(a.forEach((function(e){e.data.forEach((function(e){p.push(l(e))}))})),o.type){case"linear":var y=n(e(p).filter((function(e){return null!==e})),(function(e){return e}));return{all:y,min:Math.min.apply(Math,y),max:Math.max.apply(Math,y)};case"time":var x=t(p,(function(e){return e.getTime()})).slice(0).sort((function(e,t){return t.getTime()-e.getTime()})).reverse();return{all:x,min:x[0],max:r(x)};default:var h=e(p);return{all:h,min:h[0],max:r(h)}}},B=function(e,t,n){var i=E(e),o=[];t[i].all.forEach((function(t){var u=a(t)?U:C,c=[];n.forEach((function(n){var a=n.data.find((function(e){return u(e.data[i],t)})),s=null,l=null;if(void 0!==a){if(null!==(s=a.data[e])){var d=r(c);void 0===d?l=s:null!==d&&(l=d+s)}a.data["x"===e?"xStacked":"yStacked"]=l}c.push(l),null!==l&&o.push(l)}))})),t[e].minStacked=Math.min.apply(Math,o),t[e].maxStacked=Math.max.apply(Math,o)},A=function(e,t){return B("x",e,t)},F=function(e,t){return B("y",e,t)},H=c.timeInterval((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),L=c.timeInterval((function(e){return e.setUTCHours(0,0,0,0)}),(function(e,t){return e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),R={millisecond:[c.timeMillisecond,c.utcMillisecond],second:[c.timeSecond,c.utcSecond],minute:[c.timeMinute,c.utcMinute],hour:[c.timeHour,c.utcHour],day:[H,L],week:[c.timeWeek,c.utcWeek],sunday:[c.timeSunday,c.utcSunday],monday:[c.timeMonday,c.utcMonday],tuesday:[c.timeTuesday,c.utcTuesday],wednesday:[c.timeWednesday,c.utcWednesday],thursday:[c.timeThursday,c.utcThursday],friday:[c.timeFriday,c.utcFriday],saturday:[c.timeSaturday,c.utcSaturday],month:[c.timeMonth,c.utcMonth],year:[c.timeYear,c.utcYear]},V=Object.keys(R),N=new RegExp("^every\\s*(\\d+)?\\s*("+V.join("|")+")s?$","i");exports.bandScaleDefaults=h,exports.castBandScale=S,exports.castLinearScale=y,exports.castPointScale=function(e){var t=e;return t.type="point",t},exports.centerScale=function(e){var t=e.bandwidth();if(0===t)return e;var n=t/2;return e.round()&&(n=Math.round(n)),function(t){var r;return(null!=(r=e(t))?r:0)+n}},exports.compareDateValues=U,exports.compareValues=C,exports.computeScale=q,exports.computeXYScalesForSeries=function(e,t,n,r,a){var i=e.map((function(e){return function(e){return s({},e,{data:e.data.map((function(e){return{data:s({},e)}}))})}(e)})),o=P(i,t,n);"stacked"in t&&!0===t.stacked&&A(o,i),"stacked"in n&&!0===n.stacked&&F(o,i);var u=q(t,o.x,r,"x"),c=q(n,o.y,a,"y"),l=i.map((function(e){return s({},e,{data:e.data.map((function(e){return s({},e,{position:{x:j(e,"x",u),y:j(e,"y",c)}})}))})}));return s({},o,{series:l,xScale:u,yScale:c})},exports.createBandScale=g,exports.createDateNormalizer=f,exports.createLinearScale=p,exports.createLogScale=b,exports.createPointScale=x,exports.createPrecisionMethod=m,exports.createSymlogScale=w,exports.createTimeScale=T,exports.generateSeriesAxis=O,exports.generateSeriesXY=P,exports.getOtherAxis=E,exports.getScaleTicks=function(e,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in e){var n=t.match(N);if(n){var r=n[1],a=n[2],i=R[a][e.useUTC?1:0];if("day"===a){var o,u,c=e.domain(),s=c[0],l=c[1],d=new Date(l);return d.setDate(d.getDate()+1),null!=(o=null==(u=i.every(Number(null!=r?r:1)))?void 0:u.range(s,d))?o:[]}if(void 0===r)return e.ticks(i);var m=i.every(Number(r));if(m)return e.ticks(m)}throw new Error("Invalid tickValues: "+t)}if("ticks"in e){if(void 0===t)return e.ticks();if("number"==typeof(f=t)&&isFinite(f)&&Math.floor(f)===f)return e.ticks(t)}var f;return e.domain()},exports.isReversibleScaleSpec=function(e){return"linear"===e.type||"log"===e.type||"symlog"===e.type},exports.linearScaleDefaults=v,exports.logScaleDefaults=M,exports.precisionCutOffs=l,exports.precisionCutOffsByType=d,exports.stackAxis=B,exports.symlogScaleDefaults=D,exports.timePrecisions=["millisecond","second","minute","hour","day","month","year"],exports.timeScaleDefaults=k;
//# sourceMappingURL=nivo-scales.cjs.js.map
